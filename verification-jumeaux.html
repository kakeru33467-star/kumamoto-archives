<!DOCTYPE html>
<html>
<head>
    <title>Validation - Projet Jumeaux</title>
    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #0f172a, #1e293b);
            color: #c084fc;
            font-family: Arial, sans-serif;
            text-align: center;
            overflow: hidden;
        }

        h1 {
            margin-top: 30px;
            letter-spacing: 2px;
        }

        canvas {
            background: #0f172a;
            border: 2px solid #334155;
            box-shadow: 0 0 20px rgba(168,85,247,0.5);
            margin-top: 20px;
        }

        #info {
            margin-top: 10px;
            color: #94a3b8;
        }
    </style>
</head>
<body>

<h1>Validation d'accès – Projet Jumeaux</h1>
<p id="info">Stabilisez le flux altérique en consommant 15 fragments.</p>
<p id="score">Fragments : 0 / 15</p>

<canvas id="game" width="500" height="500"></canvas>

<script>

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gridSize = 25;
const tileCount = canvas.width / gridSize;

let snake = [{x: 10, y: 10}];
let direction = {x: 0, y: 0};

let food = randomFood();

let score = 0;
let speed = 120; // vitesse initiale
let gameInterval;

function randomFood() {
    return {
        x: Math.floor(Math.random() * tileCount),
        y: Math.floor(Math.random() * tileCount)
    };
}

function gameLoop() {

    const head = {
        x: snake[0].x + direction.x,
        y: snake[0].y + direction.y
    };

    // collision mur
    if (head.x < 0 || head.y < 0 ||
        head.x >= tileCount || head.y >= tileCount) {
        gameOver();
        return;
    }

    // collision soi-même
    for (let part of snake) {
        if (head.x === part.x && head.y === part.y) {
            gameOver();
            return;
        }
    }

    snake.unshift(head);

    // mange
    if (head.x === food.x && head.y === food.y) {
        score++;
        document.getElementById("score").innerText =
            "Fragments : " + score + " / 15";

        if (score >= 15) {
            victory();
            return;
        }

        food = randomFood();

        // accélération progressive
        speed -= 5;
        if (speed < 60) speed = 60;
        clearInterval(gameInterval);
        gameInterval = setInterval(gameLoop, speed);

    } else {
        snake.pop();
    }

    draw();
}

function draw() {

    ctx.fillStyle = "#0f172a";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // snake
    ctx.fillStyle = "#22c55e";
    for (let part of snake) {
        ctx.fillRect(
            part.x * gridSize,
            part.y * gridSize,
            gridSize - 2,
            gridSize - 2
        );
    }

    // food
    ctx.fillStyle = "#c084fc";
    ctx.fillRect(
        food.x * gridSize,
        food.y * gridSize,
        gridSize - 2,
        gridSize - 2
    );
}

function gameOver() {
    clearInterval(gameInterval);
    alert("Synchronisation rompue.");
    window.location.href = "archives.html";
}

function victory() {
    clearInterval(gameInterval);
    alert("Validation confirmée.");
    window.location.href = "projet-jumeaux.html";
}

document.addEventListener("keydown", e => {

    if (e.key === "ArrowUp" && direction.y === 0) {
        direction = {x: 0, y: -1};
    }
    if (e.key === "ArrowDown" && direction.y === 0) {
        direction = {x: 0, y: 1};
    }
    if (e.key === "ArrowLeft" && direction.x === 0) {
        direction = {x: -1, y: 0};
    }
    if (e.key === "ArrowRight" && direction.x === 0) {
        direction = {x: 1, y: 0};
    }

});

// démarre jeu
gameInterval = setInterval(gameLoop, speed);

</script>

</body>
</html>
