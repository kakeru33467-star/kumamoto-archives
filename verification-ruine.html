<!DOCTYPE html>
<html>
<head>
<title>Système altérique instable</title>
<link rel="stylesheet" href="style.css">

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #0f0f0f;
    font-family: 'Segoe UI', sans-serif;
    color: #888;
    text-align: center;
}

h1 {
    margin-top: 30px;
    color: #666;
}

/* ===================== */
/* BALLONS */
/* ===================== */

.balloon {
    position: absolute;
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #555, #1a1a1a);
    cursor: pointer;
    user-select: none;
}

/* ===================== */
/* PHASE CODE */
/* ===================== */

#codePhase {
    display: none;
    margin-top: 100px;
}

.code-drop-zone {
    width: 160px;
    height: 70px;
    border: 2px dashed #444;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 15px;
    font-size: 22px;
}

.code-block {
    width: 140px;
    height: 60px;
    background: #333;
    margin: 15px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: grab;
    border-radius: 8px;
    font-size: 20px;
}
</style>
</head>

<body>

<h1>Système instable</h1>
<p id="instruction">Fragments physiques détectés…</p>

<div id="codePhase">
    <h2>Fragments récupérés</h2>
    <div id="dropContainer"></div>
    <div id="blockContainer"></div>
</div>

<script>

/* ========================= */
/* BALLONS PHYSIQUES */
/* ========================= */

const balloons = [];
const gravity = 0.4;
const friction = 0.995;
const totalBalloons = 18;

let destroyed = 0;

class Balloon {
    constructor() {
        this.x = Math.random() * window.innerWidth;
        this.y = Math.random() * window.innerHeight * 0.5;
        this.vx = (Math.random() - 0.5) * 6;
        this.vy = Math.random() * 2;
        this.radius = 45;

        this.element = document.createElement("div");
        this.element.className = "balloon";
        document.body.appendChild(this.element);

        this.element.onclick = () => this.pop();
    }

    update() {
        this.vy += gravity;
        this.x += this.vx;
        this.y += this.vy;

        if (this.x < 0 || this.x + 90 > window.innerWidth) {
            this.vx *= -1;
        }

        if (this.y + 90 > window.innerHeight) {
            this.y = window.innerHeight - 90;
            this.vy *= -0.7;
        }

        this.vx *= friction;
        this.vy *= friction;

        this.element.style.left = this.x + "px";
        this.element.style.top = this.y + "px";
    }

    pop() {
        this.element.remove();
        destroyed++;

        if (destroyed >= totalBalloons) {
            startCodePhase();
        }
    }
}

function handleCollisions() {
    for (let i = 0; i < balloons.length; i++) {
        for (let j = i + 1; j < balloons.length; j++) {

            const b1 = balloons[i];
            const b2 = balloons[j];

            const dx = b1.x - b2.x;
            const dy = b1.y - b2.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < 90) {
                const angle = Math.atan2(dy, dx);
                const force = 3;

                b1.vx += Math.cos(angle) * force;
                b1.vy += Math.sin(angle) * force;
                b2.vx -= Math.cos(angle) * force;
                b2.vy -= Math.sin(angle) * force;
            }
        }
    }
}

function animate() {
    balloons.forEach(b => b.update());
    handleCollisions();
    requestAnimationFrame(animate);
}

for (let i = 0; i < totalBalloons; i++) {
    balloons.push(new Balloon());
}

animate();

/* ========================= */
/* PHASE CODE QUI TOMBE */
/* ========================= */

function startCodePhase() {

    document.querySelectorAll(".balloon").forEach(b => b.remove());
    document.getElementById("instruction").innerText =
        "Fragments récupérés.";

    document.getElementById("codePhase").style.display = "block";

    const codes = ["340", "660", "5700"];

    const dropContainer = document.getElementById("dropContainer");
    const blockContainer = document.getElementById("blockContainer");

    dropContainer.innerHTML = "";
    blockContainer.innerHTML = "";

    codes.forEach(() => {
        const zone = document.createElement("div");
        zone.className = "code-drop-zone";

        zone.ondragover = e => e.preventDefault();
        zone.ondrop = function(e) {
            const data = e.dataTransfer.getData("text");
            this.innerText = data;
            checkCompletion();
        };

        dropContainer.appendChild(zone);
    });

    codes.sort(() => 0.5 - Math.random());

    codes.forEach(code => {
        const block = document.createElement("div");
        block.className = "code-block";
        block.innerText = code;
        block.draggable = true;

        block.ondragstart = e => {
            e.dataTransfer.setData("text", code);
        };

        blockContainer.appendChild(block);
    });
}

function checkCompletion() {

    let filled = 0;

    document.querySelectorAll(".code-drop-zone").forEach(zone => {
        if (zone.innerText !== "") filled++;
    });

    if (filled === 3) {
        setTimeout(() => {
            window.location.href = "archives.html";
        }, 500);
    }
}

</script>

</body>
</html>
