<!DOCTYPE html>
<html>
<head>
<title>Système altérique instable</title>
<link rel="stylesheet" href="style.css">

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #111;
    font-family: 'Segoe UI', sans-serif;
    color: #aaa;
    text-align: center;
}

h1 {
    margin-top: 30px;
    color: #777;
}

/* ===================== */
/* BALLONS PHYSIQUES */
/* ===================== */

.balloon {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #666, #222);
    cursor: pointer;
    user-select: none;
}

/* ===================== */
/* PHASE CODE */
/* ===================== */

#codePhase {
    display: none;
    margin-top: 80px;
}

.code-drop-zone {
    width: 140px;
    height: 60px;
    border: 2px dashed #555;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 10px;
    font-size: 22px;
}

.code-block {
    width: 120px;
    height: 50px;
    background: #333;
    margin: 10px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: grab;
    border-radius: 6px;
}

.fade {
    animation: fadeout 1s forwards;
}

@keyframes fadeout {
    to { opacity: 0; }
}
</style>
</head>

<body>

<h1>Système instable</h1>
<p id="instruction">Fragments physiques détectés…</p>

<div id="codePhase">
    <h2>Reconstitution des séquences</h2>
    <div id="dropContainer"></div>
    <div id="blockContainer"></div>
</div>

<script>

/* ========================= */
/* PHYSIQUE BALLONS */
/* ========================= */

const balloons = [];
const gravity = 0.3;
const friction = 0.99;
const totalBalloons = 12;

let destroyed = 0;

class Balloon {
    constructor() {
        this.x = Math.random() * window.innerWidth;
        this.y = Math.random() * window.innerHeight;
        this.vx = (Math.random() - 0.5) * 4;
        this.vy = Math.random() * 2;
        this.radius = 30;

        this.element = document.createElement("div");
        this.element.className = "balloon";
        document.body.appendChild(this.element);

        this.element.onclick = () => this.pop();
    }

    update() {
        this.vy += gravity;
        this.x += this.vx;
        this.y += this.vy;

        // collisions mur
        if (this.x < 0 || this.x + 60 > window.innerWidth) {
            this.vx *= -1;
        }

        if (this.y + 60 > window.innerHeight) {
            this.y = window.innerHeight - 60;
            this.vy *= -0.8;
        }

        this.vx *= friction;
        this.vy *= friction;

        this.element.style.left = this.x + "px";
        this.element.style.top = this.y + "px";
    }

    pop() {
        this.element.remove();
        destroyed++;
        if (destroyed >= totalBalloons) {
            startCodePhase();
        }
    }
}

// collision entre ballons
function handleCollisions() {
    for (let i = 0; i < balloons.length; i++) {
        for (let j = i + 1; j < balloons.length; j++) {
            const b1 = balloons[i];
            const b2 = balloons[j];

            const dx = b1.x - b2.x;
            const dy = b1.y - b2.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < 60) {
                const angle = Math.atan2(dy, dx);
                const force = 2;

                b1.vx += Math.cos(angle) * force;
                b1.vy += Math.sin(angle) * force;
                b2.vx -= Math.cos(angle) * force;
                b2.vy -= Math.sin(angle) * force;
            }
        }
    }
}

function animate() {
    balloons.forEach(b => b.update());
    handleCollisions();
    requestAnimationFrame(animate);
}

for (let i = 0; i < totalBalloons; i++) {
    balloons.push(new Balloon());
}

animate();

/* ========================= */
/* PHASE CODE QUI TOMBE */
/* ========================= */

function startCodePhase() {

    document.querySelectorAll(".balloon").forEach(b => b.remove());

    document.getElementById("instruction").innerText =
        "Séquences retrouvées.";

    document.getElementById("codePhase").style.display = "block";

    const codes = ["340", "660", "5700"];

    const dropContainer = document.getElementById("dropContainer");
    const blockContainer = document.getElementById("blockContainer");

    dropContainer.innerHTML = "";
    blockContainer.innerHTML = "";

    codes.forEach(code => {

        const zone = document.createElement("div");
        zone.className = "code-drop-zone";
        zone.dataset.value = code;

        zone.ondragover = e => e.preventDefault();

        zone.ondrop = function(e) {
            const data = e.dataTransfer.getData("text");
            this.innerText = data;
        };

        dropContainer.appendChild(zone);
    });

    // shuffle
    codes.sort(() => 0.5 - Math.random());

    codes.forEach(code => {

        const block = document.createElement("div");
        block.className = "code-block";
        block.innerText = code;
        block.draggable = true;

        block.ondragstart = e => {
            e.dataTransfer.setData("text", code);
        };

        blockContainer.appendChild(block);
    });
}

function validate() {

    let valid = true;

    document.querySelectorAll(".code-drop-zone").forEach(zone => {
        if (zone.innerText !== zone.dataset.value) {
            valid = false;
        }
    });

    if (valid) {
        document.body.classList.add("fade");
        setTimeout(() => {
            window.location.href = "archives.html";
        }, 1000);
    } else {
        alert("Fragments mal positionnés.");
    }
}

</script>

<button onclick="validate()" style="position:fixed;bottom:30px;left:50%;transform:translateX(-50%);padding:10px 20px;">
Valider
</button>

</body>
</html>
